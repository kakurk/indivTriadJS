<!DOCTYPE html>
<html>
    <head>
        <title>Psych Experiment</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="jspsych/jspsych.js"></script>
        <script src="jspsych/plugin-html-keyboard-response.js"></script>
        <script src="jspsych/plugin-fullscreen.js" type="text/javascript"></script>
        <script src="jspsych/plugin-external-html.js" type="text/javascript"></script>
        <script src="jspsych/plugin-instructions.js" type="text/javascript"></script>
        <script src="jspsych/plugin-survey-text.js" type="text/javascript"></script>
        <script src="jspsych/plugin-survey-likert.js" type="text/javascript"></script>
        <script src="experiment.js" type="text/javascript"></script>
        <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css"></link>
        <link href="experiment.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

// grabs all variables from the url
// url variables are specified as follows:
// Ex: experiment.html?subject=s001
// urlvar.subject = 's001'
var jsPsych = initJsPsych({
  on_finish: finish_experiment,
});

var allKeyStim = ['Jennifer Anniston', 'Brad Pitt', 'Zendaya', 'Tom Holland', 'A Bar', 'A Bathroom', 'A Beach', 'A Pool'];
var myarray = Array.from({length: 8}, (x, i) => i);
var randperm = jsPsych.randomization.sampleWithoutReplacement(myarray, 8);
var c = -1;
var cc = -1;
var enc_trials_data;
var ret_trials = [];

// Initialize timeline variable. See jspsych tutorial
var timeline   = [];

d3.csv("experiment_data_abr.csv").then(function(data){

  // encoding
  var enc_trial = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: construct_encoding_stimulus,
      choices: 'ALL_KEYS',//"NO_KEYS",
      trial_duration: null,
      stimulus_duration: null,
      response_ends_trial: true,
      post_trial_gap: 1000,
      data: {
        phase: 'enc',
        objOne: jsPsych.timelineVariable('first'),
        objTwo: jsPsych.timelineVariable('second'),
        key: function(){
          return allKeyStim[randperm[c]]
        },
      }
  }

  var objects = data.map(x => pick(x, 'first', 'second'))

  var enc_trial_procedure = {
      timeline: [enc_trial],
      timeline_variables: objects,
      randomize_order: true,
      repetitions: 1,
      on_timeline_finish: set_up_retrieval,
  }
  timeline.push(enc_trial_procedure)

  // retrieval
  var ret_trial = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: construct_retrieval_stimulus,
      choices: "ALL_KEYS",
      trial_duration: null,
      stimulus_duration: null,
      response_ends_trial: true,
      post_trial_gap: 1000,
      data: {
        phase: 'ret'
      }
  }

  var ret_trial_procedure = {
      timeline: [ret_trial],
      randomize_order: false,
      repetitions: 48
  }

  timeline.push(ret_trial_procedure)

  jsPsych.run(timeline)

});

    </script>
</html>
